<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root { color-scheme: dark; }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh; display: grid; place-items: center;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      background: radial-gradient(1000px 600px at 50% -20%, #1d293a, #0b0f16 60%);
      color: #fff;
    }
    .card {
      width: min(90vw, 520px);          /* plus compacte */
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 10px;
      padding: 16px;                    /* padding rÃ©duit */
      box-shadow: 0 15px 30px rgba(0,0,0,.5);
      backdrop-filter: blur(6px);
    }
    h1 { margin: 0 0 8px; font-size: 18px; font-weight: 600; }
    p  { margin: 0 0 14px; opacity: .85; font-size: 13px; }
    label { display:block; font-size:12px; margin-bottom:6px; opacity:.9; }
    input[type="password"] {
      width: 80%; padding: 10px 12px; border-radius: 8px;
      border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: #fff;
      outline: none; font-size: 14px;
    }
    .row {
      display:flex; align-items:center; justify-content:space-between;
      margin-top: 10px; gap: 10px;
    }
    .row label { display:flex; gap:8px; align-items:center; cursor:pointer; font-size:12px; }
    button {
      appearance:none; border:none; border-radius:8px; padding:9px 14px; cursor:pointer;
      background:#2e66ff; color:#fff; font-weight:600; font-size:14px;
    }
    button:hover { background:#1c4fd7; }
    .error { color:#ff7b7b; font-size:12px; margin-top:10px; display:none; }
    .hint  { font-size:11px; opacity:.7; margin-top:8px; }
  </style>
</head>
<body>
  <div class="card" role="dialog" aria-labelledby="title">
    <h1 id="title">ðŸ”’ Protected access</h1>
    <p>Enter the password to access the demo WebRayGaussX 3D renderer.</p>

    <label for="pw">Password</label>
    <input id="pw" type="password" placeholder="Password" autocomplete="current-password" />

    <div class="row">
      <label><input id="remember" type="checkbox" /> Remember me</label>
      <button id="go" type="button">Login</button>
    </div>

    <div id="err" class="error" aria-live="polite">Wrong password</div>
    <div class="hint">Tip: press <kbd>Enter</kbd> to submit</div>
  </div>

  <script>
    // ======== CONFIG ========
    // SHA-256("secret123"):
    // fcf730b6d95236ecd3c9fc2d92d7b6b2bb061514961aec041d6c7a7192f592e4
    const PASSWORD_SHA256 = "dc9d3dde137d9931ce11f66b23f2b7a463d98127e7773dbb70c91ab303de1638";
    const TOKEN_KEY  = "rt_auth";
    const TOKEN_VAL  = "ok";
    const TARGET_PAGE = "index.html";

    // Redirige si dÃ©jÃ  authentifiÃ©
    if (localStorage.getItem(TOKEN_KEY) === TOKEN_VAL || sessionStorage.getItem(TOKEN_KEY) === TOKEN_VAL) {
      location.replace(TARGET_PAGE);
    }

    // ======== SHA-256 utils ========
    async function sha256WebCrypto(str) {
      const enc = new TextEncoder().encode(str);
      const buf = await crypto.subtle.digest("SHA-256", enc);
      return [...new Uint8Array(buf)].map(b => b.toString(16).padStart(2,"0")).join("");
    }

    // Fallback SHA-256 (JS pur) pour contextes non sÃ©curisÃ©s (HTTP, file://)
    function sha256JS(ascii) {
      function RR(v,a){ return (v>>>a) | (v<<(32-a)); }
      var mp=Math.pow, mw=mp(2,32), i,j,res='', w=[], abl=ascii.length*8;
      var h=sha256JS.h=sha256JS.h||[], k=sha256JS.k=sha256JS.k||[], pc=k.length;
      if(!pc){ let n=2; const frac=x=>((x-(x|0))*mw)|0; const prime=n=>{for(let i=2;i*i<=n;i++)if(n%i===0)return 0;return n>1}; while(pc<64){ if(prime(n)){ h[pc]=frac(Math.sqrt(n)); k[pc++]=frac(Math.cbrt(n)); } n++; } }
      ascii+='\x80'; while(ascii.length%64-56) ascii+='\x00';
      for(i=0;i<ascii.length;i++){ j=ascii.charCodeAt(i); w[i>>2]|=j<<((3-i)%4)*8; }
      w[w.length]=((abl/mw)|0); w[w.length]=abl;
      var a,b,c,d,e,f,g,hv, W=[], H=h.slice(0);
      for(j=0;j<w.length;){ a=H[0]; b=H[1]; c=H[2]; d=H[3]; e=H[4]; f=H[5]; g=H[6]; hv=H[7];
        for(i=0;i<64;i++){
          W[i]= i<16 ? w[j+i]|0 : (W[i-16] + (RR(W[i-15],7)^RR(W[i-15],18)^(W[i-15]>>>3)) + W[i-7] + (RR(W[i-2],17)^RR(W[i-2],19)^(W[i-2]>>>10)))|0;
          var ch=(e&f)^((~e)&g), maj=(a&b)^(a&c)^(b&c);
          var s0=RR(a,2)^RR(a,13)^RR(a,22), s1=RR(e,6)^RR(e,11)^RR(e,25);
          var t1=(hv + s1 + ch + k[i] + W[i])|0, t2=(s0 + maj)|0;
          hv=g; g=f; f=e; e=(d + t1)|0; d=c; c=b; b=a; a=(t1 + t2)|0;
        }
        H[0]=(H[0]+a)|0; H[1]=(H[1]+b)|0; H[2]=(H[2]+c)|0; H[3]=(H[3]+d)|0;
        H[4]=(H[4]+e)|0; H[5]=(H[5]+f)|0; H[6]=(H[6]+g)|0; H[7]=(H[7]+hv)|0;
        j+=16;
      }
      for(i=0;i<8;i++) for(j=3;j+1;j--){ var b=(H[i]>>>(j*8))&255; res+=((b<16)?0:'')+b.toString(16); }
      return res;
    }

    async function sha256Hex(str) {
      if (window.crypto?.subtle && window.isSecureContext) {
        try { return await sha256WebCrypto(str); } catch(e) {}
      }
      return sha256JS(str);
    }

    // ======== Login flow ========
    const $pw = document.getElementById("pw");
    const $err = document.getElementById("err");
    const $remember = document.getElementById("remember");
    const $go = document.getElementById("go");

    async function login() {
      $err.style.display = "none";  // reset Ã  chaque tentative
      const input = $pw.value || "";
      const ok = (await sha256Hex(input)) === PASSWORD_SHA256;
      if (!ok) { $err.style.display = "block"; return; }
      // Stocker le jeton
      ($remember.checked ? localStorage : sessionStorage).setItem(TOKEN_KEY, TOKEN_VAL);
      // Redirection
      location.replace(TARGET_PAGE);
    }

    // Effacer l'erreur dÃ¨s qu'on retape quelque chose
    $pw.addEventListener("input", () => { $err.style.display = "none"; });

    // Bouton & EntrÃ©e
    $go.addEventListener("click", login);
    $pw.addEventListener("keydown", (e) => { if (e.key === "Enter") login(); });

    // Focus direct sur le champ
    $pw.focus();
  </script>
</body>
</html>
